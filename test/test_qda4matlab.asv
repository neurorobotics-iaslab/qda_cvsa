%% test qda for matlab, work only for evaluations
clc; clear all; close all;


%% Load features and prediction of ros
datapath = '/home/paolo/cvsa/ic_cvsa_ws/src/qda_cvsa/';
features = load([datapath 'test/processed_data.csv']);
ros_prob = load([datapath 'test/node/classified.csv']);

yaml_QDA_path = [datapath 'cfg/qda_test.yaml'];
qda = loadQDA(yaml_QDA_path);

prob_all = [];
for idx_feature = 1:length(features)
    c_features = log(features(idx_feature,qda.idchans));
    c_prob = apply_qda(qda, c_features);
    prob_all = cat(1, prob_all, c_prob);
end

min_length = min(size(ros_prob,1), size(prob_all,1));

max_1 = max(ros_prob(:,1) - prob_all(1:min_length,1));
max_2 = max(ros_prob(:,2) - prob_all(1:min_length,2));

figure();
subplot(2, 2, 1);
plot(1:size(ros_prob,1), ros_prob(:,1), 'Color', 'r');
hold on;
plot(1:size(ros_prob,1), prob_all(1:min_length,1), 'Color', 'b');
title('First class for both methods')
legend('ros probs', 'matlab probs')

subplot(2, 2, 3);
plot(1:size(ros_prob,1), ros_prob(:,1)- prob_all(1:min_length,1), 'Color', 'r');
hold on;
text(2, 0.8, 'max diff: 5');
title('Diff ros and matlab')
legend('ros probs', 'matlab probs')

subplot(2, 2, 2);
plot(1:size(ros_prob,1), ros_prob(:,2), 'Color', 'r');
hold on;
plot(1:size(ros_prob,1), prob_all(1:min_length,2), 'Color', 'b');
title('Second class for both methods')
legend('Diff')

subplot(2, 2, 4);
plot(1:size(ros_prob,1), ros_prob(:,1) - prob_all(1:min_length,1), 'Color', 'r');
hold on;
text(2, 0.8, 'max diff: 5');
title('Diff ros and matlab')
legend('Diff')
